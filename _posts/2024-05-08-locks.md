---
layout: post
categories: [OS]
title: mutex, semaphore and monitor
author: tngtied
date: 2024-03-26
---

운영체제의 공유자원에 대한 Race Condition에 대응하고, 데드락을 방지하기 위한 기법 중 하나로는 상호배제(Mutual Exclusioin)이 있다. 이를 사용한 동기화 기법들로는 Mutex, Semaphore 그리고 Monitor가 있다.

# Mutex

Mutex는 임계 구역에 대해 0 또는 1을 가지는 플래그를 두고, 한 번에 하나의 스레드만이 해당 구역에 접근할 수 있도록 한다. 해당 스레드는 뮤텍스 락에 대한 소유권을 획득하게 되며, 그 스레드가 아니고서는 unlock할 수 없다. 또한, 뮤텍스는 어떤 자원이 어떤 순서로 자원에 접근할지 관리할 수 없다.
뮤텍스에 대한 작업은 Lock과 Unlock이 있다.

## Busy Wait

임계 구역에 대한 접근이 불가능할 때, 즉 임계 구역에 접근한 프로세스/스레드의 수가 접근가능한 수와 동일할 때 추가로 접근하고자 하는 스레드가 임계 영역에 들어갈 수 있을 때 까지 무한으로 접근가능한지 검사만 하는 로직을 의미한다. 이러한 유형의 락을 스핀락이라고 부르기도 한다.

## Waiting Queue, Ready Queue

뮤텍스에 접근하지 못하는 프로세스는 Busy Wait 방식과 같이 지속적으로 접근가능성을 확인하는 게 아니라, wait()을 호출해 sleep 상태로 들어가고 스스로를 waiting queue에 enque한다. 이후, signal()이 호출되어 뮤텍스가 할당해제 되었을 때 세마포어는 해당 프로세스를 reday queue로 보낸다.
이러한 방식을 채택함으로써 해당 프로세스가 계속해서 자원을 할당받기 위해 상태를 확인하는 데 소요되는 연산을 줄일 수 있다.

# Semaphore

Semaphore는 하나의 임계 구역에 제한된 수의 스레드가 접근할 수 있도록 하는 기법이다. Semaphore를 생성할 때 카운터를 초기화하는 것으로 이루어지며, 세마포어를 통해 임계 구역에 접근했다고 해서 해당 락을 소유하게 되는 것은 아니다. 또한, 임계 구역에 접근한 해당 스레드가 아니더라도 세마포어를 해제할 수 있다.
세마포어는 임계구역에 대한 상호배제는 지켜지지 않지만, 내부의 각각의 자원에 대한 상호배제가 성립된다.
세마포어에 대한 작업으로는 Initialize, Increment, Decrement가 있다.

# Monitor

세마포어의 연장선상에 있는 동기화 도구로, OS단에서 기본적으로 제공되는 뮤텍스와 달리 객체 지향 프로그래밍에서 사용되는 동기화 도구로, lock과 unlock과 같은 함수들을 일일히 호출할 필요 없이 자동화를 지원해준다.
